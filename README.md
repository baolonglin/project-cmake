# project-cmake

Emacs extension to the project package for supporting CMake as build system.

## Description

This package is an extension to Emacs' own `project` package.  While the latter understand project directories, can find files and has some `project-compile` minimalistic function, but it does not understand build systems.

The package `project-cmake` incorporates the required logic to understand that a project is to be configured, built and tested with CMake.  It also is capable of recognizing different build kits, on platforms that support it.  For instance, on Windows it can scan for MSYS2 / MINGW64 environments and used the versions of CMake and the compiler supported by it, and eventually it will also support Microsoft compilation environments.

`project-cmake` also adds new key bindings to the `project-prefix-map`, with the following default assignments

   C-x p C   -  project-cmake-configure
   C-x p m   -  project-cmake-build
   C-x p t   -  project-cmake-test

`project-cmake` can also help LSP servers by providing them with the right configuration flags on how to locate a project's build structure and build flags.  At this moment, this integration is only provided for `eglot`, via the function `project-cmake-eglot-integration` which hooks into `eglot-ensure` and updates `eglot-server-programs`.

## Usage

I have checked out this repository at a given location, say `~/src/project-cmake`. I then make the project available to Emacs with the help of `use-package`, as follows
````
(use-package project-cmake
    :load-path "~/src/project-cmake/"
    :custom
    ;; I work on Windows and build using MSYS2
    (project-cmake-default-kit 'msys2-ucrt64)
    :config
    (require 'eglot)
    (project-cmake-scan-kits)
    (project-cmake-eglot-integration))
````

For the `eglot` integration I use a very minimalistic configuration, as `project-cmake` already takes care of configuring the C/C++ language server for me:
````
(use-package eglot
  :ensure t
  :hook
  ((c-mode . eglot-ensure)
   (c++-mode . eglot-ensure))
  )
````

Note that in order for `eglot` to work with `clangd`, it may need the `compile_commands.json` generated by CMake at configuration time. When CMake has failed to configure or you did not have yet time to do it, `clangd` will not find that file. In that case you might have to restart the language server by calling `eglot-shutdown`, configuring the project with `project-cmake-configure` and reloading the C/C++ files.
